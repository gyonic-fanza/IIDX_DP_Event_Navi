<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IIDX DP Event Navigator</title>
  <style>
    /* ページ全体のフォントや背景色 */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #f9f9f9;
      color: #333;
  margin: 0 auto;
  padding: 1rem 1rem 4rem;
  max-width: 900px;
    }

    /* ページタイトル */
    h1 {
      font-weight: 700;
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
      border-bottom: 2px solid #444;
      padding-bottom: 0.3rem;
    }

    /* イベント一覧の親コンテナ */
    .event-list {
      margin-top: 1.5rem;
    }

    /* 各イベントのコンテナ */
    .event-item {
      background-color: #fff;
      border-radius: 6px;
      box-shadow: 0 2px 5px rgb(0 0 0 / 0.1);
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 6px solid #005a9e; /* アクセントカラー */
      /* 文字選択を許可するためuser-select削除 */
    }

    /* イベントタイトル */
    .event-title {
      font-weight: 700;
      font-size: 1.2rem;
      margin-bottom: 0.3rem;
      color: #0078d7;
    }

    /* 詳細情報のスタイル */
    .event-detail {
      font-size: 1rem;
      line-height: 1.6;
      margin: 0.2rem 0;
      color: #555;
    }

    /* ラベルのスタイル */
    .event-label {
      font-weight: 600;
      color: #444;
      margin-right: 0.3rem;
    }

    /* 折りたたみ時は非表示（今回は使ってない） */
    .event-details-collapsed {
      display: none;
    }

    /* リンクのスタイル */
    a {
      color: #0078d7;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }

footer {
  background-color: #fff8e1; /* 薄いクリーム色で注意を強調 */
  border-top: 1px solid #ddd;
  padding: 1.5rem 1rem;
  margin-top: 3rem;
  font-size: 0.9rem;
  color: #444;
  line-height: 1.5;
  white-space: pre-wrap; /* 改行を反映 */
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  user-select: text; /* 文字選択可能 */
}

footer p {
  margin: 0;
  white-space: pre-wrap; /* 改行をきちんと表示 */
}
    /* スマホ対応の余白調整 */
    @media (max-width: 600px) {
      body {
        padding: 1rem 0.8rem 3rem;
      }
    }
  </style>
</head>
<footer>
  <p>⚠ 注意事項

このページの情報は手動で更新しています。そのため、記載内容には細心の注意を払っておりますが、実際のイベント内容と異なる可能性があります。
必ずリンク先にて各イベントの詳細をご確認ください。

記載内容に誤りなどがございましたら、お手数ですが <a href="https://x.com/GYONIC">GYONIC (X : @GYONIC)</a> までご連絡ください。

また、ページ内に記載のないイベント等の情報がございましたら、あわせて <a href="https://x.com/GYONIC">GYONIC (X : @GYONIC)</a> までご一報いただけますと幸いです。

⚠ Disclaimer

All information on this page is updated manually. While every effort has been made to ensure accuracy, there may be discrepancies between the listed content and the actual event details.
Please make sure to check the official links for the most up-to-date and accurate information.

If you notice any mistakes or issues, please contact <a href="https://x.com/GYONIC">GYONIC (X : @GYONIC)</a>.

Additionally, if there are any events not listed on this page, please feel free to inform <a href="https://x.com/GYONIC">GYONIC (X : @GYONIC)</a> as well.

⚠ 안내 사항

이 페이지의 정보는 수동으로 업데이트되고 있습니다. 가능한 한 정확하게 작성하려 노력하고 있으나, 실제 이벤트 내용과 차이가 있을 수 있습니다.
각 이벤트의 세부사항은 반드시 링크를 통해 확인해 주시기 바랍니다.

기재 내용에 오류나 문제가 있을 경우, <a href="https://x.com/GYONIC">GYONIC (X : @GYONIC)</a> 에게 연락 부탁드립니다.

또한, 이 페이지에 기재되지 않은 이벤트 정보가 있다면 <a href="https://x.com/GYONIC">GYONIC (X : @GYONIC)</a> 에게 알려주시면 감사하겠습니다.</p>
</footer>
<body>
  <h1>IIDX DP Event Navigator</h1>
  <div class="event-list" id="event-list"></div>

<script>
  /**
   * 日時文字列を「yyyy/mm/dd(aaa) hh:mm:ss」形式にフォーマット
   * @param {string} dateString ISO形式の日時文字列
   * @returns {string} フォーマット済み日時文字列
   */
  function formatDateTime(dateString) {
    if (!dateString) return '';
  
    const date = new Date(dateString);
    if (isNaN(date)) return dateString;
  
    const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    const year = date.getFullYear();
    const month = ('0' + (date.getMonth() + 1)).slice(-2);
    const day = ('0' + date.getDate()).slice(-2);
    const dayOfWeek = daysOfWeek[date.getDay()];
    const hour = ('0' + date.getHours()).slice(-2);
    const minute = ('0' + date.getMinutes()).slice(-2);
  
    return `${year}/${month}/${day}(${dayOfWeek}) ${hour}:${minute}`;
  }

  // Google Apps ScriptのAPI URL
  const apiUrl = 'https://script.google.com/macros/s/AKfycbxk8j0rNhcpkstS_MZM9q2b_j4W1v0bJyKXU5KtS8zd1Jv1wrLm5VoSaydZsOWOxOOnbQ/exec';

  // イベントデータ取得と表示処理
  fetch(apiUrl)
    .then(res => res.json())
  .then(data => {
    // date_remain (remain) の昇順にソート
    data.sort((a, b) => {
      const remainA = a['date_remain'] ?? Infinity;
      const remainB = b['date_remain'] ?? Infinity;
      return remainA - remainB;
    });
      const container = document.getElementById('event-list');
      container.innerHTML = ''; // 既存内容をクリア
data.forEach(event => {
  const div = document.createElement('div');
  div.className = 'event-item';

  // banner_urlがある場合はリンク付き画像を作成
  if (event['banner_url']) {
    const linkBanner = document.createElement('a');
    linkBanner.href = event['information_url'] || '#';
    linkBanner.target = '_blank';
    linkBanner.rel = 'noopener noreferrer';

    const img = document.createElement('img');
    img.src = event['banner_url'];
    img.alt = event['title'] || 'Event Banner';
    img.style.width = '100%';
    img.style.borderRadius = '6px 6px 0 0'; // 上の角を丸めるなど調整
    img.style.display = 'block';
    img.style.marginBottom = '0.5rem';
img.onerror = () => {
  img.style.display = 'none'; // もしくは代替画像に差し替え
};

    linkBanner.appendChild(img);
    div.appendChild(linkBanner);
  }

  // イベントタイトルにリンクをつける
  const h2 = document.createElement('h2');
  h2.className = 'event-title';

  if (event['information_url']) {
    const linkTitle = document.createElement('a');
    linkTitle.href = event['information_url'];
    linkTitle.target = '_blank';
    linkTitle.rel = 'noopener noreferrer';
    linkTitle.textContent = event['title'] || 'No Title';
    h2.appendChild(linkTitle);
  } else {
    h2.textContent = event['title'] || 'No Title';
  }
  div.appendChild(h2);

  // 以降、詳細情報の追加（generateDetails関数を利用）
  const details = generateDetails(event);
  details.forEach(({ label, value, isHTML }) => {
    if (!value) return;
    const p = document.createElement('p');
    p.className = 'event-detail';
    const spanLabel = document.createElement('span');
    spanLabel.className = 'event-label';
    spanLabel.textContent = label;
    p.appendChild(spanLabel);
    if (isHTML) {
      p.innerHTML += value;
    } else {
      p.appendChild(document.createTextNode(value));
    }
    div.appendChild(p);
  });

  container.appendChild(div);
});
    })
    .catch(err => {
      console.error('Failed to load event data:', err);
      const container = document.getElementById('event-list');
      container.textContent = 'Failed to load event data.';
    });

  /**
   * イベント詳細情報を配列で生成
   * isHTML=trueの場合はvalueがHTML文字列として扱われる
   * @param {object} event APIから取得したイベントオブジェクト
   * @returns {Array<{label:string, value:string, isHTML:boolean}>}
   */
  function generateDetails(event) {
    const timezone = event['timezone'] || '';
    const start = formatDateTime(event['start_date']);
    const end = formatDateTime(event['end_date']);
    const duration = [start, end].filter(Boolean).join(' ～ ');
    const durationWithTz = timezone ? `${duration} (${timezone})` : duration;
    const remain = event['date_remain'] ?? Infinity;

    return [
      { label: 'Event Duration:', value: durationWithTz, isHTML: false },
      { 
        label: 'Organized by:', 
        value: event['organizer_name']
          ? `<a href="https://x.com/${event['organizer_id'] || '#'}" target="_blank" rel="noopener noreferrer">${event['organizer_name']}</a>`
          : '',
        isHTML: true
      },
      { 
        label: 'Hashtag:', 
        value: event['hashtag']
          ? `<a href="https://x.com/hashtag/${encodeURIComponent(event['hashtag'])}" target="_blank" rel="noopener noreferrer">#${event['hashtag']}</a>`
          : '',
        isHTML: true
      },
      { label: 'Event Type:', value: event['event_type'] || '', isHTML: false },
      { label: 'Songs:', value: event['songs'] || '', isHTML: false },
      { label: 'Status:', value: event['status'] ? 'Active' : 'Inactive', isHTML: false },
    ];
  }
</script>
</body>
</html>
